function array_intersect(a){var c={},b=arguments.length,f=b-1,g="",r={},k=0,m="";a:for(g in a){k=1;b:for(;k<b;k++){r=arguments[k];for(m in r)if(r[m]===a[g]){k===f&&(c[g]=a[g]);continue b}continue a}}return c}function array_combinations(a){return Array.prototype.reduce.call(a,function(a,b){var f=[];a.forEach(function(a){b.forEach(function(b){f.push(a.concat([b]))})});return f},[[]])}String.prototype.pad=function(a,c,b){return c||(c=" "),0<(a-=this.length)?(c=Array(Math.ceil(a/c.length)+1).join(c)).substr(0,b=!b?a:1==b?0:Math.ceil(a/2))+this+c.substr(0,a-b):this};function array_pairs(a,c){for(var b=[],f=0;f<=a.length-2;++f)for(var g=f+!c;g<=a.length-1;++g)b.push([a[f],a[g]]);return b}(function(a,c,b){function f(a,b){var d=new Date("Mar 15, 1994 "+b);return 1440*p.indexOf(a)+60*d.getHours()+d.getMinutes()}function g(b,c,d,t,h,x){if(!b||!t)return!1;var l=!1;a.each(array_intersect(b.split(""),t.split("")),function(a,e){var t=f(e,c),b=f(e,d),n=f(e,h),w=f(e,x);l=t<=w&&b>=n;return!l});return l}function r(b){function c(a){return a.toString().pad(2,"0")}m=a.map(a("#calendar").fullCalendar("clientEvents"),function(a,b){return a.url?null:[[p[a.start.getDay()],c(a.start.getHours())+":"+c(a.start.getMinutes()),c(a.end.getHours())+":"+c(a.end.getMinutes())]]});console.log(q);var d=[];a.each(b,function(b,h){var c=a.grep(h,function(b,h){var e=b.Course.match(/([A-Za-z ]+[0-9 ]+)[A-Za-z]+([0-9]+)/),d=e[1],e=parseInt(e[2]),c=q[d],d=q["^"+d];if(c&&-1==c.indexOf(e)||d&&-1!=d.indexOf(e))return console.log("Rejecting section #"+e),!1;var n=!1;a.each(m,function(e,d){a.each([1,2,3,4,5,6],function(a,e){n=g(b[s+e],b[u+e],b[v+e],d[0],d[1],d[2]);return!n});return!n});return!n});d.push(c)});b=d;a.each(b,function(b,d){if(!d.length)return a("#no-permutations-modal").dialog("open"),!1});b=array_combinations(b);k=[];a.each(b,function(b,d){var c=array_pairs(d,!1),l=!1;a.each(c,function(b,e){var d=e[0],c=e[1];a.each(y,function(a,b){var e=b[0],h=b[1];l=g(d[s+e],d[u+e],d[v+e],c[s+h],c[u+h],c[v+h]);return!l});return!l});l||k.push(d)});b=a("#slider").slider("option","max",k.length-1).slider("option","value",0).add("#slider-explanation");1<k.length?b.show():b.hide();a("#courses-list").show();a("#calendar").fullCalendar("refetchEvents")}var k=[],m=[],y=array_pairs("123456",!0),p="UMTWRFS",q={},s="MeetsOn",u="StartTime",v="EndTime";a(function(){a("#submit").click(function(d){var c=a("#term :selected").attr("name");d=a("#courseids").val().split(/,\s*/);var h=[],f=[];g=0;q={};if(!d.length||1==d.length&&""==d[0])k=[],m=[],a("#calendar").fullCalendar("refetchEvents");g=0;q={};a.each(d,function(d,g){if(g&&g.length){var e=g.match(/([A-Za-z ]+[0-9 ]+)(?:{(.*?)})?/),k=e[1];if(e[2]!=b){var m=[],n=0==e[2].indexOf("^");a.each(e[2].slice(!!n).split(/\s*|\s*/),function(a,b){m.push(parseInt(b))});q[(n?"^":"")+k.toUpperCase()]=m}h.push(a.getJSON("http://data.adicu.com/courses?api_token=51314d99a237900002959a87&term="+c+"&courseid="+k+"&jsonp=?",function(a){f.push(a.data)}))}});a.when.apply(a,h).done(function(){r(f)})});a("#no-permutations-modal").dialog({modal:!0,autoOpen:!1});var f=a("#calendar"),g=0;a("#slider").slider({value:0,min:0,slide:function(a,b){g=b.value;f.fullCalendar("refetchEvents")}});f.fullCalendar({events:function(b,c,h){var f=[],l=a("#courses-list");l.html("");k.length?a.each(k[g],function(b,e){var d=["http://www.columbia.edu/cu/bulletin/uwb/subj/",e.Course.replace(/([A-Za-z ]+)([0-9 ]+)([A-Za-z]+)([0-9]+)/,"$1/$3$2-"+e.Term+"-$4")].join("");a.each([1,2,3,4,5,6],function(b,c){e[s+c]&&a.each(e[s+c].split(""),function(a,b){var h=e[u+c],g=parseInt(h.slice(0,2)),h=parseInt(h.slice(3,5)),k=e[v+c],l=parseInt(k.slice(0,2)),k=parseInt(k.slice(3,5));f.push({start:new Date(2013,2,3+p.indexOf(b),g,h),end:new Date(2013,2,3+p.indexOf(b),l,k),url:d,title:[e.CourseTitle," (\u00a7",e.Course.slice(-3),")"].join(""),backgroundColor:"#405E74",editable:!1})})});l.append(['<li><a href="',d,'" target="_blank">',e.CourseTitle," (\u00a7",e.Course.slice(-3),") (",e.CallNumber,")</a></li>"].join(""))}):m.length&&a("#no-permutations-modal").dialog("open");m.length&&a.each(m,function(a,b){var d=b[1],c=parseInt(d.slice(0,2)),d=parseInt(d.slice(3,5)),h=b[2],g=parseInt(h.slice(0,2)),h=parseInt(h.slice(3,5));f.push({start:new Date(2013,2,3+p.indexOf(b[0]),c,d),end:new Date(2013,2,3+p.indexOf(b[0]),g,h),title:"Unavailable"})});h(f)},defaultView:"agendaWeek",header:null,columnFormat:{agendaWeek:"ddd"},allDaySlot:!1,year:2013,month:2,date:3,minTime:"8:00am",maxTime:"10:00pm",allDayDefault:!1,editable:!0,selectable:!0,selectHelper:!0,eventBackgroundColor:"#7F2425",eventBorderColor:"black",contentHeight:1E3,select:function(a,b,c){f.fullCalendar("renderEvent",{title:"Unavailable",start:a,end:b,allDay:c},!1).fullCalendar("unselect")},eventClick:function(a){if(a.url)return c.open(a.url),!1;f.fullCalendar("removeEvents",a.id||a._id)}});a("#term").change(function(b){a.getJSON(a(this).find(":selected").attr("name")+".json",function(b){a("#courseids").bind("keydown",function(b){b.keyCode===a.ui.keyCode.TAB&&a(this).data("ui-autocomplete").menu.active?b.preventDefault():b.keyCode===a.ui.keyCode.ENTER&&(a("#submit").click(),b.preventDefault())}).autocomplete({minLength:0,source:function(c,d){d(a.ui.autocomplete.filter(b,c.term.split(/,\s*/).pop()))},focus:function(a,b){return!1},select:function(a,b){var c=this.value.split(/,\s*/);c.pop();c.push(b.item.value);c.push("");this.value=c.join(", ");return!1}}).data("ui-autocomplete")._renderItem=function(b,c){return a("<li>").append('<a><span class="title">'+c.value+'</span><br /><span class="subtitle">'+c.name+"</span></a>").appendTo(b)}})}).change()})})(jQuery,this);